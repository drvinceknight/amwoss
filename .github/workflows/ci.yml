name: CI

on:
  push:
  pull_request:
  # Run weakly at 00:00 on Sunday.
  schedule:
  - cron:  '0 0 * * 0'

# This job installs dependencies, build the site, and pushes it to `gh-pages``
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    # Install environment
    - name: Install environment
      run: |
        sudo apt-get update
        #LaTeX packages
        sudo apt-get install -y texlive-latex-extra
        sudo apt-get install -y texlive-xetex
        sudo apt-get install -y texlive-lang-greek
        sudo apt-get install -y latexmk
        sudo apt-get install lmodern
        #To check spelling
        sudo apt-get install aspell aspell-en
        Conda
        wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
        bash miniconda.sh -b -p $HOME/miniconda
        export PATH="$HOME/miniconda/bin:$PATH"
        hash -r
        conda config --set always_yes yes --set changeps1 no
        conda update -q conda
        #Useful for debugging any issues with conda
        conda info -a
        conda env create -f environment.yml
        source activate ampwoss
        inv env  # Finish install of environment

    - name: Doctest
      run: |
        inv doctest --style  # Test all code and also check style

    - name: Check LaTeX compiles
      run: |
        cd src; pdflatex -shell-escape main.tex  # Check LaTeX Compiles
